<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Quản lý sinh viên</title>
</head>
<body>

<h2>Quản lý sinh viên</h2>

<!-- FORM -->
<input type="hidden" id="id">

Tên: <input type="text" id="name">
Tuổi: <input type="number" id="age">
Giới tính: <input type="text" id="gender">
Email: <input type="text" id="email">

<button onclick="addOrUpdate()">Lưu</button>

<hr>

<!-- SEARCH -->
<input type="text" id="searchName">
<button onclick="search()">Tìm kiếm</button>
<button onclick="clearFilter()">Xoá bộ lọc</button>

<hr>

<!-- TABLE -->
<table border="1" width="100%">
    <thead>
        <tr>
            <th>ID</th>
            <th>Tên</th>
            <th>Tuổi</th>
            <th>Giới tính</th>
            <th>Email</th>
            <th>Hành động</th>
        </tr>
    </thead>
    <tbody id="data"></tbody>
</table>

<script>
const API = "http://localhost:8080/api/students";

function loadData() {
    fetch(API)
        .then(res => res.json())
        .then(data => {
            let html = "";
            data.forEach(s => {
                html += `
                    <tr>
                        <td>${s.id}</td>
                        <td>${s.name}</td>
                        <td>${s.age}</td>
                        <td>${s.gender}</td>
                        <td>${s.email}</td>
                        <td>
                            <button onclick="edit(${s.id})">Sửa</button>
                            <button onclick="remove(${s.id})">Xóa</button>
                        </td>
                    </tr>
                `;
            });
            document.getElementById("data").innerHTML = html;
        });
}

function addOrUpdate() {
    let id = document.getElementById("id").value;
    let student = {
        name: document.getElementById("name").value,
        age: document.getElementById("age").value,
        gender: document.getElementById("gender").value,
        email: document.getElementById("email").value
    };

    let url = id ? API + "/update/" + id : API;

    fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(student)
    }).then(() => {
        resetForm();
        loadData();
    });
}

function edit(id) {
    fetch(API + "/" + id)
        .then(res => res.json())
        .then(s => {
            document.getElementById("id").value = s.id;
            document.getElementById("name").value = s.name;
            document.getElementById("age").value = s.age;
            document.getElementById("gender").value = s.gender;
            document.getElementById("email").value = s.email;
        });
}

function remove(id) {
    fetch(API + "/delete/" + id, { method: "POST" })
        .then(() => loadData());
}

function search() {
    let name = document.getElementById("searchName").value;
    fetch(API + "/search?name=" + name)
        .then(res => res.json())
        .then(data => {
            let html = "";
            data.forEach(s => {
                html += `
                    <tr>
                        <td>${s.id}</td>
                        <td>${s.name}</td>
                        <td>${s.age}</td>
                        <td>${s.gender}</td>
                        <td>${s.email}</td>
                        <td></td>
                    </tr>
                `;
            });
            document.getElementById("data").innerHTML = html;
        });
}

function resetForm() {
    document.getElementById("id").value = "";
    document.getElementById("name").value = "";
    document.getElementById("age").value = "";
    document.getElementById("gender").value = "";
    document.getElementById("email").value = "";
}

function clearFilter() {
    document.getElementById("searchName").value = "";
    loadData(); // gọi lại API Get All
}

loadData();
</script>

</body>
</html>
